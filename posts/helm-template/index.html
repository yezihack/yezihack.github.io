<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us><head><script defer language=javascript type=text/javascript src=/js/bundle.min.14549c76bbc96f0af1574b0259efd70e52908cd36fb4d14ed3d290a1b6479eae.js></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=/images/p2.png><title itemprop=name>空树之空 - Helm Chart 模板</title><meta property="og:title" content="空树之空 - Helm Chart 模板"><meta name=twitter:title content="空树之空 - Helm Chart 模板"><meta itemprop=name content="空树之空 - Helm Chart 模板"><meta name=application-name content="空树之空 - Helm Chart 模板"><meta property="og:site_name" content="空树之空"><meta name=description content><meta itemprop=description content><meta property="og:description" content><meta name=twitter:description content><base href=https://yezihack.github.io/posts/helm-template/><link rel=canonical href=https://yezihack.github.io/posts/helm-template/ itemprop=url><meta name=url content="https://yezihack.github.io/posts/helm-template/"><meta name=twitter:url content="https://yezihack.github.io/posts/helm-template/"><meta property="og:url" content="https://yezihack.github.io/posts/helm-template/"><meta property="og:updated_time" content="29011-29-06T1144:17:23+0800"><link rel=sitemap type=application/xml title=Sitemap href=https://yezihack.github.io/sitemap.xml><meta name=robots content="index,follow"><meta name=googlebot content="index,follow"><meta name=twitter:site content><meta name=twitter:creator content><meta property="fb:admins" content><meta name=apple-mobile-web-app-title content="空树之空"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black"><meta property="og:type" content="article"><meta property="article:publisher" content><meta property="og:article:published_time" content="29011-29-06T1144:17:23+0800"><meta property="article:published_time" content="29011-29-06T1144:17:23+0800"><meta property="og:article:author" content="百里"><meta property="article:author" content="百里"><meta name=author content="百里"><script defer type=application/ld+json>{"@context":"http://schema.org","@type":"Article","headline":"Helm Chart 模板","author":{"@type":"Person","name":""},"datePublished":"2023-11-29","description":"","wordCount":"736","mainEntityOfPage":"True","dateModified":"2023-11-29","image":{"@type":"imageObject","url":""},"publisher":{"@type":"Organization","name":"空树之空","logo":{"@type":"imageObject","url":"\/images\/p2.png"}}}</script><meta name=generator content="Hugo 0.114.0"><link type=text/css rel=stylesheet href=/css/bundle.min.aa949ea27ee9836d60d6ea4c073fd0885f51948c7eea0247da6b1aff4bc25c44.css><style>body{--sidebar-bg-color:#202020;--sidebar-img-border-color:#515151;--sidebar-p-color:#909090;--sidebar-h1-color:#FFF;--sidebar-a-color:#FFF;--sidebar-socials-color:#FFF;--text-color:#222;--bkg-color:#FAF9F6;--post-title-color:#303030;--list-color:#5a5a5a;--link-color:#268bd2;--date-color:#515151;--table-border-color:#E5E5E5;--table-stripe-color:#F9F9F9;--code-color:#bf616a;--code-background-color:#E5E5E5;--moon-sun-color:#FFF;--moon-sun-background-color:#515151}body.dark-theme{--text-color:#eee;--bkg-color:#121212;--post-title-color:#DBE2E9;--list-color:#9d9d9d;--link-color:#268bd2;--date-color:#9a9a9a;--table-border-color:#515151;--table-stripe-color:#202020;--code-color:#ff7f7f;--code-background-color:#393D47}body{background-color:var(--bkg-color)}</style></head><body class=dark-theme><div class=wrapper><aside class=sidebar><div class="container sidebar-sticky"><div class=light-dark align=right><button class=btn-light-dark title="Toggle light/dark mode"><svg class="moon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16"><path fill="currentcolor" d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/></svg><svg class="sun" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16"><path fill="currentcolor" d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></svg></button></div><div class=sidebar-about><h1 class=brand><a href=https://yezihack.github.io/><img src=/images/logo_transparent.png alt="brand image"></a>
<a href=https://yezihack.github.io/><h1>空树之空</h1></a></h1><p class=lead>《空樹之空》博客是一个技术导向的平台，聚焦于Kubernetes、DevOps和Linux等领域。通过简洁而优美的文字，我们提供对这些技术主题的深入探索和实用的指南。</p></div><nav><ul class=sidebar-nav><li class=heading><a href=/about/>About</a></li><li class=heading><a href=/posts/>Posts</a></li><li class=sub-heading>Recent</li><li class=bullet><a href=https://yezihack.github.io/posts/linux-ssh-agent/>Linux ssh-agent 极简教程</a></li><li class=bullet><a href=https://yezihack.github.io/posts/linux-ccze/>Linux Ccze 彩色化日志文件输出的工具</a></li><li class=bullet><a href=https://yezihack.github.io/posts/wsl-install/>Windows 子系统 Linux 系统之 WSL2 安装</a></li><li class=bullet><a href=https://yezihack.github.io/posts/firewalld/>Linux Firewalld 极简教程</a></li><li class=bullet><a href=https://yezihack.github.io/posts/chronyd/>Linux Chronyd 极简教程</a></li><li class=heading><a href=/tags/>Tags</a></li></ul></nav><a target=_blank class=social title="RSS Feed" href=https://yezihack.github.io//posts/index.xml><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 1280 1280"><g transform="translate(0.000000,1280.000000) scale(0.100000,-0.100000)" fill="currentcolor"><path d="M2295 11929c-284-12-642-45-707-65-17-5-18-63-18-1039 0-569 4-1036 8-1039 5-3 74 6 153 19 510 86 1168 95 1789 25 1348-153 2602-677 3670-1531 385-308 820-744 1126-1129 842-1060 1362-2313 1514-3650 70-621 61-1279-25-1789-13-79-22-148-19-153 3-4 471-8 1039-8h1035l5 23c51 225 85 942 67 1419-23 605-77 1044-198 1617-294 14e2-927 2734-1823 3846-1043 1295-2364 2259-3909 2854-1158 447-2451 656-3707 6e2z"/><path d="M2255 7845c-269-25-620-81-667-106-17-9-18-55-18-899 0-706 3-890 13-890 6 0 66 18 132 41 130 44 288 79 467 105 154 21 577 30 749 15 1207-107 2267-823 2814-1902 166-327 268-637 330-1001 38-227 48-384 42-662-8-348-44-590-126-831-23-66-41-126-41-132 0-10 184-13 890-13 844 0 890 1 899 18 27 50 88 452 110 725 14 162 14 624 1 782-59 703-233 1323-545 1945-481 956-1313 1788-2270 2268-620 310-1239 483-1940 542-165 14-669 10-840-5z"/><path d="M2519 3815c-391-66-725-336-868-703-79-201-96-462-45-677 83-344 338-641 666-774 116-47 205-69 330-80 412-39 811 153 1040 5e2 193 292 240 648 128 981-135 403-492 699-914 757-1e2 14-241 12-337-4z"/></g></svg></a><p class=footnote><br>&copy; 2024 百里江山. All rights reserved.</p></div></aside><main class="content container"><div class=post><div class=info><h1 class=post-title><a href=https://yezihack.github.io/posts/helm-template/>Helm Chart 模板</a></h1><time datetime=2023-11-29T18:44:17+0800 class=post-date>November 29, 2023</time><ul class=tags><li class=tag-helm><a href=https://yezihack.github.io/tags/helm>helm</a></li><li class=tag-chart><a href=https://yezihack.github.io/tags/chart>chart</a></li><li class=tag-云原生><a href=https://yezihack.github.io/tags/%E4%BA%91%E5%8E%9F%E7%94%9F>云原生</a></li></ul></div><h2 id=1-介绍>1. 介绍</h2><p>Chart 模板才是 Helm 的灵魂所在,学会模板才算入门 Helm,让我们一起学习吧.</p><h2 id=2-模板语法>2. 模板语法</h2><p>模板命令要括在 {{ 和 }} 之间。</p><p>如:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ConfigMap</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: {{ <span style=color:#ae81ff>.Release.Name }}-configmap</span>
</span></span><span style=display:flex><span><span style=color:#f92672>data</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>myvalue</span>: <span style=color:#e6db74>&#34;Hello World&#34;</span>
</span></span></code></pre></div><h2 id=3-内置对象>3. 内置对象</h2><p>系统自带一些内置对象,可以在模板里使用.</p><p>Release： Release对象描述了版本发布本身。包含了以下对象：</p><ul><li>Release.Name： release名称</li><li>Release.Namespace： 版本中包含的命名空间(如果manifest没有覆盖的话)</li><li>Release.IsUpgrade： 如果当前操作是升级或回滚的话，该值将被设置为true</li><li>Release.IsInstall： 如果当前操作是安装的话，该值将被设置为true</li><li>Release.Revision： 此次修订的版本号。安装时是1，每次升级或回滚都会自增</li><li>Release.Service： 该service用来渲染当前模板。Helm里始终Helm</li></ul><p>Values： Values对象是从values.yaml文件和用户提供的文件传进模板的。默认为空</p><p>Chart： Chart.yaml文件内容。 Chart.yaml里的所有数据在这里都可以可访问的。比如 {{ .Chart.Name }}-{{ .Chart.Version }} 会打印出 mychart-0.1.0</p><p>Files： 在chart中提供访问所有的非特殊文件的对象。你不能使用它访问Template对象，只能访问其他文件。 请查看这个 文件访问部分了解更多信息</p><ul><li>Files.Get 通过文件名获取文件的方法。 （.Files.Getconfig.ini）</li><li>Files.GetBytes 用字节数组代替字符串获取文件内容的方法。 对图片之类的文件很有用</li><li>Files.Glob 用给定的shell glob模式匹配文件名返回文件列表的方法</li><li>Files.Lines 逐行读取文件内容的方法。迭代文件中每一行时很有用</li><li>Files.AsSecrets 使用Base 64编码字符串返回文件体的方法</li><li>Files.AsConfig 使用YAML格式返回文件体的方法</li></ul><p>Template： 包含当前被执行的当前模板信息</p><ul><li>Template.Name: 当前模板的命名空间文件路径 (e.g. mychart/templates/mytemplate.yaml)</li><li>Template.BasePath: 当前chart模板目录的路径 (e.g. mychart/templates)</li></ul><h2 id=4-values-文件>4. Values 文件</h2><ul><li>chart中的values.yaml文件</li><li>如果是子chart，就是父chart中的values.yaml文件</li><li>使用-f参数(helm install -f myvals.yaml ./mychart)传递到 helm install 或 helm upgrade的values文件</li><li>使用&ndash;set (比如helm install &ndash;set foo=bar ./mychart)传递的单个参数</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ConfigMap</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: {{ <span style=color:#ae81ff>.Release.Name }}-configmap</span>
</span></span><span style=display:flex><span><span style=color:#f92672>data</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>myvalue</span>: <span style=color:#e6db74>&#34;Hello World&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>drink</span>: {{ <span style=color:#ae81ff>.Values.favoriteDrink }}</span>
</span></span></code></pre></div><h2 id=5-函数>5. 函数</h2><table><thead><tr><th>函数名</th><th>作用</th><th>用法</th></tr></thead><tbody><tr><td>quote</td><td>添加引号</td><td></td></tr><tr><td>repeat</td><td>重复</td><td>repeat 5</td></tr><tr><td>upper</td><td>大写</td><td></td></tr><tr><td>lower</td><td>小写</td><td></td></tr><tr><td>default</td><td>默认值</td><td>default &ldquo;xxx&rdquo;</td></tr><tr><td>lookup</td><td>获取资源的对象</td><td></td></tr></tbody></table><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># 普通</span>
</span></span><span style=display:flex><span><span style=color:#f92672>food</span>: {{ <span style=color:#ae81ff>quote .Values.favorite.food }}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 使用管道符</span>
</span></span><span style=display:flex><span><span style=color:#f92672>food</span>: {{  <span style=color:#ae81ff>.Values.favorite.food | quote}}</span>
</span></span></code></pre></div><p>lookup 函数</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e># kubectl get pod mypod -n mynamespace</span>
</span></span><span style=display:flex><span>lookup <span style=color:#e6db74>&#34;v1&#34;</span> <span style=color:#e6db74>&#34;Pod&#34;</span> <span style=color:#e6db74>&#34;mynamespace&#34;</span> <span style=color:#e6db74>&#34;mypod&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># kubectl get pods -n mynamespace</span>
</span></span><span style=display:flex><span>lookup <span style=color:#e6db74>&#34;v1&#34;</span> <span style=color:#e6db74>&#34;Pod&#34;</span> <span style=color:#e6db74>&#34;mynamespace&#34;</span> <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># kubectl get pods --all-namespaces</span>
</span></span><span style=display:flex><span>lookup <span style=color:#e6db74>&#34;v1&#34;</span> <span style=color:#e6db74>&#34;Pod&#34;</span> <span style=color:#e6db74>&#34;&#34;</span> <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># kubectl get namespace mynamespace</span>
</span></span><span style=display:flex><span>lookup <span style=color:#e6db74>&#34;v1&#34;</span> <span style=color:#e6db74>&#34;Namespace&#34;</span> <span style=color:#e6db74>&#34;&#34;</span> <span style=color:#e6db74>&#34;mynamespace&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># kubectl get namespaces</span>
</span></span><span style=display:flex><span>lookup <span style=color:#e6db74>&#34;v1&#34;</span> <span style=color:#e6db74>&#34;Namespace&#34;</span> <span style=color:#e6db74>&#34;&#34;</span> <span style=color:#e6db74>&#34;&#34;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># 返回mynamespace对象的annotations属性：</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>(lookup &#34;v1&#34; &#34;Namespace&#34; &#34;&#34; &#34;mynamespace&#34;).metadata.annotations</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>{{ <span style=color:#ae81ff>range $index, $service := (lookup &#34;v1&#34; &#34;Service&#34; &#34;mynamespace&#34; &#34;&#34;).items }}</span>
</span></span><span style=display:flex><span>    {{<span style=color:#ae81ff>/* do something with each service */}}</span>
</span></span><span style=display:flex><span>{{ <span style=color:#ae81ff>end }}</span>
</span></span></code></pre></div><p><strong>运算符也是函数</strong></p><p>运算符(eq, ne, lt, gt, and, or等等)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml></code></pre></div><h2 id=6-流控制>6. 流控制</h2><ul><li>if/else， 用来创建条件语句</li><li>with， 用来指定范围</li><li>range， 提供"for each"类型的循环</li><li>define 在模板中声明一个新的命名模板</li><li>template 导入一个命名模板</li><li>block 声明一种特殊的可填充的模板块</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>{{ <span style=color:#ae81ff>if PIPELINE }}</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Do something</span>
</span></span><span style=display:flex><span>{{ <span style=color:#ae81ff>else if OTHER PIPELINE }}</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Do something else</span>
</span></span><span style=display:flex><span>{{ <span style=color:#ae81ff>else }}</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Default case</span>
</span></span><span style=display:flex><span>{{ <span style=color:#ae81ff>end }}</span>
</span></span></code></pre></div><p>去掉空格</p><ul><li>{{- (包括添加的横杠和空格)表示向左删除空白， 而 -}}表示右边的空格应该被去掉</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ConfigMap</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: {{ <span style=color:#ae81ff>.Release.Name }}-configmap</span>
</span></span><span style=display:flex><span><span style=color:#f92672>data</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>myvalue</span>: <span style=color:#e6db74>&#34;Hello World&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>drink</span>: {{ <span style=color:#ae81ff>.Values.favorite.drink | default &#34;tea&#34; | quote }}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>food</span>: {{ <span style=color:#ae81ff>.Values.favorite.food | upper | quote }}</span>
</span></span><span style=display:flex><span>  {{- <span style=color:#ae81ff>if eq .Values.favorite.drink &#34;coffee&#34; }}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>mug</span>: <span style=color:#e6db74>&#34;true&#34;</span>
</span></span><span style=display:flex><span>  {{- <span style=color:#ae81ff>end }}</span>
</span></span></code></pre></div><p>预留空格使用: indent 函数</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>annotations</span>:
</span></span><span style=display:flex><span>{{- <span style=color:#ae81ff>with .Values.podAnnotations }}</span>
</span></span><span style=display:flex><span>{{- <span style=color:#ae81ff>toYaml . | nindent 8 }}</span>
</span></span><span style=display:flex><span>{{- <span style=color:#ae81ff>end }}</span>
</span></span></code></pre></div><p>with</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>{{- <span style=color:#ae81ff>with .Values.favorite }}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>drink</span>: {{ <span style=color:#ae81ff>.drink | default &#34;tea&#34; | quote }}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>food</span>: {{ <span style=color:#ae81ff>.food | upper | quote }}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>release</span>: {{ <span style=color:#ae81ff>$.Release.Name }}</span>
</span></span><span style=display:flex><span>{{- <span style=color:#ae81ff>end }}</span>
</span></span></code></pre></div><p>range</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ConfigMap</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: {{ <span style=color:#ae81ff>.Release.Name }}-configmap</span>
</span></span><span style=display:flex><span><span style=color:#f92672>data</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>myvalue</span>: <span style=color:#e6db74>&#34;Hello World&#34;</span>
</span></span><span style=display:flex><span>  {{- <span style=color:#ae81ff>with .Values.favorite }}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>drink</span>: {{ <span style=color:#ae81ff>.drink | default &#34;tea&#34; | quote }}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>food</span>: {{ <span style=color:#ae81ff>.food | upper | quote }}</span>
</span></span><span style=display:flex><span>  {{- <span style=color:#ae81ff>end }}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>toppings</span>: |-<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    {{- range .Values.pizzaToppings }}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    - {{ . | title | quote }}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    {{- end }}   </span>    
</span></span><span style=display:flex><span>  <span style=color:#f92672>sizes</span>: |-<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    {{- range tuple &#34;small&#34; &#34;medium&#34; &#34;large&#34; }}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    - {{ . }}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    {{- end }}  </span>    
</span></span></code></pre></div><h2 id=7-常见用法>7. 常见用法</h2><h3 id=71-常量>7.1. 常量</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>namespace</span>: {{ <span style=color:#ae81ff>.Release.Namespace | quote }}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>name</span>: {{ <span style=color:#ae81ff>printf &#34;%s-config&#34; (include &#34;redis.fullname&#34; .) }}</span>
</span></span></code></pre></div><h3 id=72-ifelse>7.2. IF/ELSE</h3><ul><li>注意<code>{{- }}</code>只使用一个 <code>-</code></li><li><code>-</code> 代表消除空格的</li></ul><p>values.yaml</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>persistence</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>enable</span>: <span style=color:#66d9ef>false</span>    
</span></span><span style=display:flex><span>  <span style=color:#f92672>storageClass</span>: <span style=color:#e6db74>&#34;&#34;</span> 
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span>{{- <span style=color:#ae81ff>if and .Values.persistence.enable .Values.persistence.storageClass }}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>StatefulSet</span>
</span></span><span style=display:flex><span>{{- <span style=color:#ae81ff>else }}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span>{{- <span style=color:#ae81ff>end }}</span>
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><h3 id=73-with>7.3. with</h3><p>values.yaml</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># 备注,支持多行备注</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span>: 
</span></span><span style=display:flex><span>  <span style=color:#f92672>desc</span>: <span style=color:#e6db74>&#34;备注&#34;</span> 
</span></span><span style=display:flex><span>  <span style=color:#f92672>title</span>: <span style=color:#e6db74>&#34;备注2&#34;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>{{- <span style=color:#ae81ff>with .Values.annotations }}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>annotations</span>:
</span></span><span style=display:flex><span>{{- <span style=color:#ae81ff>toYaml . | nindent 4  }}</span>
</span></span><span style=display:flex><span>{{- <span style=color:#ae81ff>end }}</span>
</span></span></code></pre></div><h3 id=74-dict>7.4. dict</h3><ul><li>dict 相当于字典, key/value 模式.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>{{<span style=color:#ae81ff>/*</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>获取 secret 设置的密码</span>
</span></span><span style=display:flex><span><span style=color:#75715e>*/}}</span>
</span></span><span style=display:flex><span>{{- <span style=color:#ae81ff>define &#34;getValueFromSecret&#34; }}</span>
</span></span><span style=display:flex><span>    {{- <span style=color:#ae81ff>$obj := (lookup &#34;v1&#34; &#34;Secret&#34; .Namespace .Name).data -}}</span>
</span></span><span style=display:flex><span>    {{- <span style=color:#ae81ff>if $obj }}</span>
</span></span><span style=display:flex><span>        {{- <span style=color:#ae81ff>index $obj .Key | b64dec -}}</span>
</span></span><span style=display:flex><span>    {{- <span style=color:#ae81ff>end -}}</span>
</span></span><span style=display:flex><span>{{- <span style=color:#ae81ff>end }}</span>
</span></span></code></pre></div><p>使用</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>{{- <span style=color:#ae81ff>include &#34;getValueFromSecret&#34; (dict &#34;Namespace&#34; .Release.Namespace &#34;Name&#34; (include &#34;redis.secretName&#34; .) &#34;Key&#34; &#34;password&#34;  -}}</span>
</span></span></code></pre></div><h2 id=8-实例模板>8. 实例模板</h2><h2 id=9-名称>9. 名称</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>{{<span style=color:#ae81ff>/*</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>Create a default fully qualified app name.</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>We truncate at 63 chars because some Kubernetes name fields are limited to this (by the DNS naming spec).</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>If release name contains chart name it will be used as a full name.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>*/}}</span>
</span></span><span style=display:flex><span>{{- <span style=color:#ae81ff>define &#34;redis.fullname&#34; -}}</span>
</span></span><span style=display:flex><span>{{- <span style=color:#ae81ff>if .Values.fullnameOverride }}</span>
</span></span><span style=display:flex><span>{{- <span style=color:#ae81ff>.Values.fullnameOverride | trunc 63 | trimSuffix &#34;-&#34; }}</span>
</span></span><span style=display:flex><span>{{- <span style=color:#ae81ff>else }}</span>
</span></span><span style=display:flex><span>{{- <span style=color:#ae81ff>$name := default .Chart.Name .Values.nameOverride }}</span>
</span></span><span style=display:flex><span>{{- <span style=color:#ae81ff>if contains $name .Release.Name }}</span>
</span></span><span style=display:flex><span>{{- <span style=color:#ae81ff>.Release.Name | trunc 63 | trimSuffix &#34;-&#34; }}</span>
</span></span><span style=display:flex><span>{{- <span style=color:#ae81ff>else }}</span>
</span></span><span style=display:flex><span>{{- <span style=color:#ae81ff>printf &#34;%s-%s&#34; .Release.Name $name | trunc 63 | trimSuffix &#34;-&#34; }}</span>
</span></span><span style=display:flex><span>{{- <span style=color:#ae81ff>end }}</span>
</span></span><span style=display:flex><span>{{- <span style=color:#ae81ff>end }}</span>
</span></span><span style=display:flex><span>{{- <span style=color:#ae81ff>end }}</span>
</span></span></code></pre></div><h3 id=91-生成随机密码>9.1. 生成随机密码</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>{{<span style=color:#ae81ff>/*</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>如果未设置则生成随机密码，默认长度为：16</span>
</span></span><span style=display:flex><span><span style=color:#75715e>*/}}</span>
</span></span><span style=display:flex><span>{{- <span style=color:#ae81ff>define &#34;get.password&#34; }}</span>
</span></span><span style=display:flex><span>    {{- <span style=color:#ae81ff>$len := (default 16 .Values.db.password_length ) | int -}}</span>
</span></span><span style=display:flex><span>    {{- <span style=color:#ae81ff>if empty .Values.db.password -}}</span>
</span></span><span style=display:flex><span>        {{- <span style=color:#ae81ff>randAlphaNum $len -}}</span>
</span></span><span style=display:flex><span>    {{- <span style=color:#ae81ff>else -}}</span>
</span></span><span style=display:flex><span>        {{- <span style=color:#ae81ff>.Values.db.password -}}</span>
</span></span><span style=display:flex><span>    {{- <span style=color:#ae81ff>end -}}    </span>
</span></span><span style=display:flex><span>{{- <span style=color:#ae81ff>end }}</span>
</span></span></code></pre></div><hr><div class=footer><a class=previous-post href="https://yezihack.github.io/posts/helm-tutorial/?ref=footer"><span style=font-weight:700>« Previous</span><br>Helm 入门学习</a><div class=next-post><a href="https://yezihack.github.io/posts/helm-command/?ref=footer"><span style=font-weight:700>Next »</span><br>Helm 常用命令</a></div></div></div></main><div class=article-toc><div class=toc-wrapper><h4 id=contents></h4><nav id=TableOfContents><ul><li><a href=#1-介绍>1. 介绍</a></li><li><a href=#2-模板语法>2. 模板语法</a></li><li><a href=#3-内置对象>3. 内置对象</a></li><li><a href=#4-values-文件>4. Values 文件</a></li><li><a href=#5-函数>5. 函数</a></li><li><a href=#6-流控制>6. 流控制</a></li><li><a href=#7-常见用法>7. 常见用法</a><ul><li><a href=#71-常量>7.1. 常量</a></li><li><a href=#72-ifelse>7.2. IF/ELSE</a></li><li><a href=#73-with>7.3. with</a></li><li><a href=#74-dict>7.4. dict</a></li></ul></li><li><a href=#8-实例模板>8. 实例模板</a></li><li><a href=#9-名称>9. 名称</a><ul><li><a href=#91-生成随机密码>9.1. 生成随机密码</a></li></ul></li></ul></nav></div></div></div></body></html>