<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us><head><script defer language=javascript type=text/javascript src=/js/bundle.min.14549c76bbc96f0af1574b0259efd70e52908cd36fb4d14ed3d290a1b6479eae.js></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=/favicon.png><title itemprop=name>空树之空 - 第三章 Kubernetes 资源管理</title><meta property="og:title" content="空树之空 - 第三章 Kubernetes 资源管理"><meta name=twitter:title content="空树之空 - 第三章 Kubernetes 资源管理"><meta itemprop=name content="空树之空 - 第三章 Kubernetes 资源管理"><meta name=application-name content="空树之空 - 第三章 Kubernetes 资源管理"><meta property="og:site_name" content="空树之空"><meta name=description content><meta itemprop=description content><meta property="og:description" content><meta name=twitter:description content><base href=https://yezihack.github.io/posts/k8s-resource/><link rel=canonical href=https://yezihack.github.io/posts/k8s-resource/ itemprop=url><meta name=url content="https://yezihack.github.io/posts/k8s-resource/"><meta name=twitter:url content="https://yezihack.github.io/posts/k8s-resource/"><meta property="og:url" content="https://yezihack.github.io/posts/k8s-resource/"><meta property="og:updated_time" content="28010-28-04T1019:54:21+0800"><link rel=sitemap type=application/xml title=Sitemap href=https://yezihack.github.io/sitemap.xml><meta name=robots content="index,follow"><meta name=googlebot content="index,follow"><meta name=twitter:site content><meta name=twitter:creator content><meta property="fb:admins" content><meta name=apple-mobile-web-app-title content="空树之空"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black"><meta property="og:type" content="article"><meta property="article:publisher" content><meta property="og:article:published_time" content="28010-28-04T1019:54:21+0800"><meta property="article:published_time" content="28010-28-04T1019:54:21+0800"><meta property="og:article:author" content="百里"><meta property="article:author" content="百里"><meta name=author content="百里"><script defer type=application/ld+json>{"@context":"http://schema.org","@type":"Article","headline":"第三章 Kubernetes 资源管理","author":{"@type":"Person","name":""},"datePublished":"2021-10-28","description":"","wordCount":"478","mainEntityOfPage":"True","dateModified":"2021-10-28","image":{"@type":"imageObject","url":""},"publisher":{"@type":"Organization","name":"空树之空","logo":{"@type":"imageObject","url":""}}}</script><meta name=generator content="Hugo 0.114.0"><link type=text/css rel=stylesheet href=/css/bundle.min.aa949ea27ee9836d60d6ea4c073fd0885f51948c7eea0247da6b1aff4bc25c44.css><style>body{--sidebar-bg-color:#202020;--sidebar-img-border-color:#515151;--sidebar-p-color:#909090;--sidebar-h1-color:#FFF;--sidebar-a-color:#FFF;--sidebar-socials-color:#FFF;--text-color:#222;--bkg-color:#FAF9F6;--post-title-color:#303030;--list-color:#5a5a5a;--link-color:#268bd2;--date-color:#515151;--table-border-color:#E5E5E5;--table-stripe-color:#F9F9F9;--code-color:#bf616a;--code-background-color:#E5E5E5;--moon-sun-color:#FFF;--moon-sun-background-color:#515151}body.dark-theme{--text-color:#eee;--bkg-color:#121212;--post-title-color:#DBE2E9;--list-color:#9d9d9d;--link-color:#268bd2;--date-color:#9a9a9a;--table-border-color:#515151;--table-stripe-color:#202020;--code-color:#ff7f7f;--code-background-color:#393D47}body{background-color:var(--bkg-color)}</style></head><body class=dark-theme><div class=wrapper><aside class=sidebar><div class="container sidebar-sticky"><div class=light-dark align=right><button class=btn-light-dark title="Toggle light/dark mode"><svg class="moon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16"><path fill="currentcolor" d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/></svg><svg class="sun" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16"><path fill="currentcolor" d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></svg></button></div><div class=sidebar-about><h1 class=brand><a href=https://yezihack.github.io/><img src=/images/head.jpg alt="brand image"></a>
<a href=https://yezihack.github.io/><h1>空树之空</h1></a></h1><p class=lead>《空樹之空》博客是一个技术导向的平台，聚焦于Kubernetes、DevOps和Linux等领域。通过简洁而优美的文字，我们提供对这些技术主题的深入探索和实用的指南。</p></div><nav><ul class=sidebar-nav><li class=heading><a href=/about/>About</a></li><li class=heading><a href=/posts/>Posts</a></li><li class=sub-heading>Recent</li><li class=bullet><a href=https://yezihack.github.io/posts/haproxy-keepalived/>Haproxy + Keepalived 实现 k8s 集群高可用</a></li><li class=bullet><a href=https://yezihack.github.io/posts/istio-ratelimit/>Istio 限流实现</a></li><li class=bullet><a href=https://yezihack.github.io/posts/istio-install/>Istio 安装</a></li><li class=bullet><a href=https://yezihack.github.io/posts/etcd-v3.2/>云运维笔记(10) Etcd V3.2 集群二进制搭建</a></li><li class=bullet><a href=https://yezihack.github.io/posts/etcd-v3.4/>云运维笔记(11) Etcd V3.4 集群二进制搭建</a></li><li class=heading><a href=/tags/>Tags</a></li></ul></nav><a target=_blank class=social title="RSS Feed" href=https://yezihack.github.io//posts/index.xml><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 1280 1280"><g transform="translate(0.000000,1280.000000) scale(0.100000,-0.100000)" fill="currentcolor"><path d="M2295 11929c-284-12-642-45-707-65-17-5-18-63-18-1039 0-569 4-1036 8-1039 5-3 74 6 153 19 510 86 1168 95 1789 25 1348-153 2602-677 3670-1531 385-308 820-744 1126-1129 842-1060 1362-2313 1514-3650 70-621 61-1279-25-1789-13-79-22-148-19-153 3-4 471-8 1039-8h1035l5 23c51 225 85 942 67 1419-23 605-77 1044-198 1617-294 14e2-927 2734-1823 3846-1043 1295-2364 2259-3909 2854-1158 447-2451 656-3707 6e2z"/><path d="M2255 7845c-269-25-620-81-667-106-17-9-18-55-18-899 0-706 3-890 13-890 6 0 66 18 132 41 130 44 288 79 467 105 154 21 577 30 749 15 1207-107 2267-823 2814-1902 166-327 268-637 330-1001 38-227 48-384 42-662-8-348-44-590-126-831-23-66-41-126-41-132 0-10 184-13 890-13 844 0 890 1 899 18 27 50 88 452 110 725 14 162 14 624 1 782-59 703-233 1323-545 1945-481 956-1313 1788-2270 2268-620 310-1239 483-1940 542-165 14-669 10-840-5z"/><path d="M2519 3815c-391-66-725-336-868-703-79-201-96-462-45-677 83-344 338-641 666-774 116-47 205-69 330-80 412-39 811 153 1040 5e2 193 292 240 648 128 981-135 403-492 699-914 757-1e2 14-241 12-337-4z"/></g></svg></a><p class=footnote><br>&copy; 2023 百里江山. All rights reserved.</p></div></aside><main class="content container"><div class=post><div class=info><h1 class=post-title><a href=https://yezihack.github.io/posts/k8s-resource/>第三章 Kubernetes 资源管理</a></h1><time datetime=2021-10-28T16:19:54+0800 class=post-date>October 28, 2021</time><ul class=tags><li class=tag-k8s><a href=https://yezihack.github.io/tags/k8s>k8s</a></li><li class=tag-云原生><a href=https://yezihack.github.io/tags/%E4%BA%91%E5%8E%9F%E7%94%9F>云原生</a></li><li class=tag-kubernetes><a href=https://yezihack.github.io/tags/kubernetes>kubernetes</a></li></ul></div><blockquote><p>本章节主要介绍yaml语法和kubernetes的资源管理方式</p></blockquote><h2 id=资源管理介绍>资源管理介绍</h2><p>在kubernetes中，所有的内容都抽象为资源，用户需要通过操作资源来管理kubernetes。</p><blockquote><p>kubernetes的本质上就是一个集群系统，用户可以在集群中部署各种服务，所谓的部署服务，其实就是在kubernetes集群中运行一个个的容器，并将指定的程序跑在容器中。</p><p>kubernetes的最小管理单元是pod而不是容器，所以只能将容器放在<code>Pod</code>中，而kubernetes一般也不会直接管理Pod，而是通过<code>Pod控制器</code>来管理Pod的。</p><p>Pod可以提供服务之后，就要考虑如何访问Pod中服务，kubernetes提供了<code>Service</code>资源实现这个功能。</p><p>当然，如果Pod中程序的数据需要持久化，kubernetes还提供了各种<code>存储</code>系统。</p></blockquote><p><img src=https://cdn.jsdelivr.net/gh/yezihack/assets/b/image-20200406225334627.png?imageslim alt></p><blockquote><p>学习kubernetes的核心，就是学习如何对集群上的<code>Pod、Pod控制器、Service、存储</code>等各种资源进行操作</p></blockquote><h2 id=yaml语言介绍>YAML语言介绍</h2><p>YAML是一个类似 XML、JSON 的标记性语言。它强调以<strong>数据</strong>为中心，并不是以标识语言为重点。因而YAML本身的定义比较简单，号称"一种人性化的数据格式语言"。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;heima&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;age&gt;</span>15<span style=color:#f92672>&lt;/age&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;address&gt;</span>Beijing<span style=color:#f92672>&lt;/address&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/heima&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>heima</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>age</span>: <span style=color:#ae81ff>15</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>address</span>: <span style=color:#ae81ff>Beijing</span>
</span></span></code></pre></div><p>YAML的语法比较简单，主要有下面几个：</p><ul><li>大小写敏感</li><li>使用缩进表示层级关系</li><li>缩进不允许使用tab，只允许空格( 低版本限制 )</li><li>缩进的空格数不重要，只要相同层级的元素左对齐即可</li><li>&lsquo;#&lsquo;表示注释</li></ul><p>YAML支持以下几种数据类型：</p><ul><li>纯量：单个的、不可再分的值</li><li>对象：键值对的集合，又称为映射（mapping）/ 哈希（hash） / 字典（dictionary）</li><li>数组：一组按次序排列的值，又称为序列（sequence） / 列表（list）</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># 纯量, 就是指的一个简单的值，字符串、布尔值、整数、浮点数、Null、时间、日期</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 1 布尔类型</span>
</span></span><span style=display:flex><span><span style=color:#f92672>c1</span>: <span style=color:#66d9ef>true</span> <span style=color:#ae81ff>(或者True)</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 2 整型</span>
</span></span><span style=display:flex><span><span style=color:#f92672>c2</span>: <span style=color:#ae81ff>234</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 3 浮点型</span>
</span></span><span style=display:flex><span><span style=color:#f92672>c3</span>: <span style=color:#ae81ff>3.14</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 4 null类型 </span>
</span></span><span style=display:flex><span><span style=color:#f92672>c4</span>: <span style=color:#ae81ff>~ </span> <span style=color:#75715e># 使用~表示null</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 5 日期类型</span>
</span></span><span style=display:flex><span><span style=color:#f92672>c5</span>: <span style=color:#e6db74>2018-02-17</span>    <span style=color:#75715e># 日期必须使用ISO 8601格式，即yyyy-MM-dd</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 6 时间类型</span>
</span></span><span style=display:flex><span><span style=color:#f92672>c6</span>: <span style=color:#e6db74>2018-02-17T15:02:31</span><span style=color:#ae81ff>+08</span>:<span style=color:#ae81ff>00</span>  <span style=color:#75715e># 时间使用ISO 8601格式，时间和日期之间使用T连接，最后使用+代表时区</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 7 字符串类型</span>
</span></span><span style=display:flex><span><span style=color:#f92672>c7</span>: <span style=color:#ae81ff>heima    </span> <span style=color:#75715e># 简单写法，直接写值 , 如果字符串中间有特殊字符，必须使用双引号或者单引号包裹 </span>
</span></span><span style=display:flex><span><span style=color:#f92672>c8</span>: <span style=color:#ae81ff>line1</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>line2    </span> <span style=color:#75715e># 字符串过多的情况可以拆成多行，每一行会被转化成一个空格</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># 对象</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 形式一(推荐):</span>
</span></span><span style=display:flex><span><span style=color:#f92672>heima</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>age</span>: <span style=color:#ae81ff>15</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>address</span>: <span style=color:#ae81ff>Beijing</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 形式二(了解):</span>
</span></span><span style=display:flex><span><span style=color:#f92672>heima</span>: {<span style=color:#f92672>age: 15,address</span>: <span style=color:#ae81ff>Beijing}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># 数组</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 形式一(推荐):</span>
</span></span><span style=display:flex><span><span style=color:#f92672>address</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>顺义</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>昌平	</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 形式二(了解):</span>
</span></span><span style=display:flex><span><span style=color:#f92672>address</span>: [<span style=color:#ae81ff>顺义,昌平]</span>
</span></span></code></pre></div><blockquote><p>小提示：</p><p>1 书写yaml切记<code>:</code> 后面要加一个空格</p><p>2 如果需要将多段yaml配置放在一个文件中，中间要使用<code>---</code>分隔</p><p>3 下面是一个yaml转json的网站，可以通过它验证yaml是否书写正确</p></blockquote><p><a href=https://www.json2yaml.com/convert-yaml-to-json target=_blank>YAML转JSON</a></p><h2 id=资源管理方式>资源管理方式</h2><ul><li><p>命令式对象管理：直接使用命令去操作kubernetes资源</p><p><code>kubectl run nginx-pod --image=nginx:1.17.1 --port=80</code></p></li><li><p>命令式对象配置：通过命令配置和配置文件去操作kubernetes资源</p><p><code>kubectl create/patch -f nginx-pod.yaml</code></p></li><li><p>声明式对象配置：通过apply命令和配置文件去操作kubernetes资源</p><p><code>kubectl apply -f nginx-pod.yaml</code></p></li></ul><table><thead><tr><th>类型</th><th>操作对象</th><th>适用环境</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>命令式对象管理</td><td>对象</td><td>测试</td><td>简单</td><td>只能操作活动对象，无法审计、跟踪</td></tr><tr><td>命令式对象配置</td><td>文件</td><td>开发</td><td>可以审计、跟踪</td><td>项目大时，配置文件多，操作麻烦</td></tr><tr><td>声明式对象配置</td><td>目录</td><td>开发</td><td>支持目录操作</td><td>意外情况下难以调试</td></tr></tbody></table><h3 id=命令式对象管理>命令式对象管理</h3><p><strong>kubectl命令</strong></p><p>kubectl是kubernetes集群的命令行工具，通过它能够对集群本身进行管理，并能够在集群上进行容器化应用的安装部署。kubectl命令的语法如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-md data-lang=md><span style=display:flex><span>kubectl [command] [type] [name] [flags]
</span></span></code></pre></div><p><strong>comand</strong>：指定要对资源执行的操作，例如create、get、delete</p><p><strong>type</strong>：指定资源类型，比如deployment、pod、service</p><p><strong>name</strong>：指定资源的名称，名称大小写敏感</p><p><strong>flags</strong>：指定额外的可选参数</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#75715e># 查看所有pod</span>
</span></span><span style=display:flex><span>kubectl get pod 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 查看某个pod</span>
</span></span><span style=display:flex><span>kubectl get pod pod_name
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 查看某个pod,以yaml格式展示结果</span>
</span></span><span style=display:flex><span>kubectl get pod pod_name -o yaml
</span></span></code></pre></div><p><strong>资源类型</strong></p><p>kubernetes中所有的内容都抽象为资源，可以通过下面的命令进行查看:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>kubectl api-resources
</span></span></code></pre></div><p>经常使用的资源有下面这些：</p><p><strong>操作</strong></p><p>kubernetes允许对资源进行多种操作，可以通过&ndash;help查看详细的操作命令</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>kubectl --help
</span></span></code></pre></div><p>经常使用的操作有下面这些：</p><p>下面以一个namespace / pod的创建和删除简单演示下命令的使用：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#75715e># 创建一个namespace</span>
</span></span><span style=display:flex><span>[root@master ~]<span style=color:#75715e># kubectl create namespace dev</span>
</span></span><span style=display:flex><span>namespace/dev created
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 获取namespace</span>
</span></span><span style=display:flex><span>[root@master ~]<span style=color:#75715e># kubectl get ns</span>
</span></span><span style=display:flex><span>NAME              STATUS   AGE
</span></span><span style=display:flex><span><span style=color:#66d9ef>default</span>           Active   21h
</span></span><span style=display:flex><span>dev               Active   21s
</span></span><span style=display:flex><span>kube-node-lease   Active   21h
</span></span><span style=display:flex><span>kube-public       Active   21h
</span></span><span style=display:flex><span>kube-system       Active   21h
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 在此namespace下创建并运行一个nginx的Pod</span>
</span></span><span style=display:flex><span>[root@master ~]<span style=color:#75715e># kubectl run pod --image=nginx -n dev</span>
</span></span><span style=display:flex><span>kubectl run --generator=deployment/apps.v1 is DEPRECATED and will be removed <span style=color:#66d9ef>in</span> a future version. Use kubectl run --generator=run-pod/v1 or kubectl create instead.
</span></span><span style=display:flex><span>deployment.apps/pod created
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 查看新创建的pod</span>
</span></span><span style=display:flex><span>[root@master ~]<span style=color:#75715e># kubectl get pod -n dev</span>
</span></span><span style=display:flex><span>NAME                   READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>pod-864f9875b9-pcw7x   <span style=color:#ae81ff>1</span>/<span style=color:#ae81ff>1</span>     Running   <span style=color:#ae81ff>0</span>          21s
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 删除指定的pod</span>
</span></span><span style=display:flex><span>[root@master ~]<span style=color:#75715e># kubectl delete pod pod-864f9875b9-pcw7x</span>
</span></span><span style=display:flex><span>pod <span style=color:#e6db74>&#34;pod-864f9875b9-pcw7x&#34;</span> deleted
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 删除指定的namespace</span>
</span></span><span style=display:flex><span>[root@master ~]<span style=color:#75715e># kubectl delete ns dev</span>
</span></span><span style=display:flex><span>namespace <span style=color:#e6db74>&#34;dev&#34;</span> deleted
</span></span></code></pre></div><h3 id=命令式对象配置>命令式对象配置</h3><p>命令式对象配置就是使用命令配合配置文件一起来操作kubernetes资源。</p><p>1） 创建一个nginxpod.yaml，内容如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Namespace</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>dev</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginxpod</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>dev</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx-containers</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>nginx:1.17.1</span>
</span></span></code></pre></div><p>2）执行create命令，创建资源：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>[root@master ~]<span style=color:#75715e># kubectl create -f nginxpod.yaml</span>
</span></span><span style=display:flex><span>namespace/dev created
</span></span><span style=display:flex><span>pod/nginxpod created
</span></span></code></pre></div><p>此时发现创建了两个资源对象，分别是namespace和pod</p><p>3）执行get命令，查看资源：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>[root@master ~]<span style=color:#75715e>#  kubectl get -f nginxpod.yaml</span>
</span></span><span style=display:flex><span>NAME            STATUS   AGE
</span></span><span style=display:flex><span>namespace/dev   Active   18s
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NAME            READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>pod/nginxpod    <span style=color:#ae81ff>1</span>/<span style=color:#ae81ff>1</span>     Running   <span style=color:#ae81ff>0</span>          17s
</span></span></code></pre></div><p>这样就显示了两个资源对象的信息</p><p>4）执行delete命令，删除资源：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>[root@master ~]<span style=color:#75715e># kubectl delete -f nginxpod.yaml</span>
</span></span><span style=display:flex><span>namespace <span style=color:#e6db74>&#34;dev&#34;</span> deleted
</span></span><span style=display:flex><span>pod <span style=color:#e6db74>&#34;nginxpod&#34;</span> deleted
</span></span></code></pre></div><p>此时发现两个资源对象被删除了</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-md data-lang=md><span style=display:flex><span>总结:
</span></span><span style=display:flex><span>	命令式对象配置的方式操作资源，可以简单的认为：命令  +  yaml配置文件（里面是命令需要的各种参数）
</span></span></code></pre></div><h3 id=声明式对象配置>声明式对象配置</h3><p>声明式对象配置跟命令式对象配置很相似，但是它只有一个命令apply。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#75715e># 首先执行一次kubectl apply -f yaml文件，发现创建了资源</span>
</span></span><span style=display:flex><span>[root@master ~]<span style=color:#75715e>#  kubectl apply -f nginxpod.yaml</span>
</span></span><span style=display:flex><span>namespace/dev created
</span></span><span style=display:flex><span>pod/nginxpod created
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 再次执行一次kubectl apply -f yaml文件，发现说资源没有变动</span>
</span></span><span style=display:flex><span>[root@master ~]<span style=color:#75715e>#  kubectl apply -f nginxpod.yaml</span>
</span></span><span style=display:flex><span>namespace/dev unchanged
</span></span><span style=display:flex><span>pod/nginxpod unchanged
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-md data-lang=md><span style=display:flex><span>总结:
</span></span><span style=display:flex><span>    其实声明式对象配置就是使用apply描述一个资源最终的状态（在yaml中定义状态）
</span></span><span style=display:flex><span>	使用apply操作资源：
</span></span><span style=display:flex><span>        如果资源不存在，就创建，相当于 kubectl create
</span></span><span style=display:flex><span>		如果资源已存在，就更新，相当于 kubectl patch
</span></span></code></pre></div><blockquote><p>扩展：kubectl可以在node节点上运行吗 ?</p></blockquote><pre><code>kubectl的运行是需要进行配置的，它的配置文件是\$HOME/.kube，如果想要在node节点运行此命令，需要将master上的.kube文件复制到node节点上，即在master节点上执行下面操作：
</code></pre><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>scp  -r  HOME/.kube   node1<span style=color:#960050;background-color:#1e0010>:</span> HOME/
</span></span></code></pre></div><blockquote><p>使用推荐: 三种方式应该怎么用 ?</p></blockquote><p>创建/更新资源 使用声明式对象配置 kubectl apply -f XXX.yaml</p><p>删除资源 使用命令式对象配置 kubectl delete -f XXX.yaml</p><p>查询资源 使用命令式对象管理 kubectl get(describe) 资源名称</p><h2 id=参考>参考</h2><ol><li>以上笔记来自于黑马视频课程整理.</li><li>视频入口：<a href=https://www.bilibili.com/video/BV1cK4y1L7Am target=_blank>https://www.bilibili.com/video/BV1cK4y1L7Am</a></li></ol><h2 id=关于作者>关于作者</h2><p>我的博客：https://yezihack.github.io</p><p>欢迎关注我的微信公众号【空树之空】，共同学习，一起进步~
<img src=https://cdn.jsdelivr.net/gh/yezihack/assets/b/20210122112114.png?imageslim alt=空树之空></p><hr><div class=footer><a class=previous-post href="https://yezihack.github.io/posts/k8s-install/?ref=footer"><span style=font-weight:700>« Previous</span><br>第二章 Kubernetes 安装</a><div class=next-post><a href="https://yezihack.github.io/posts/k8s-operation/?ref=footer"><span style=font-weight:700>Next »</span><br>第四章 Kubernetes 实战操作</a></div></div></div></main><div class=article-toc><div class=toc-wrapper><h4 id=contents></h4><nav id=TableOfContents><ul><li><a href=#资源管理介绍>资源管理介绍</a></li><li><a href=#yaml语言介绍>YAML语言介绍</a></li><li><a href=#资源管理方式>资源管理方式</a><ul><li><a href=#命令式对象管理>命令式对象管理</a></li><li><a href=#命令式对象配置>命令式对象配置</a></li><li><a href=#声明式对象配置>声明式对象配置</a></li></ul></li><li><a href=#参考>参考</a></li><li><a href=#关于作者>关于作者</a></li></ul></nav></div></div></div></body></html>